<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>第十一周符号及符号解析 - 计算机系统基础</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="弁言.html"><strong aria-hidden="true">1.</strong> 弁言</a></li><li class="chapter-item expanded "><a href="计算机系统基础一课程概述.html"><strong aria-hidden="true">2.</strong> 计算机系统基础一课程概述.md</a></li><li class="chapter-item expanded "><a href="第一周计算机系统概述.html"><strong aria-hidden="true">3.</strong> 第一周计算机系统概述</a></li><li class="chapter-item expanded "><a href="第二周数据的表示和存储.html"><strong aria-hidden="true">4.</strong> 第二周数据的表示和存储</a></li><li class="chapter-item expanded "><a href="第三周运算电路基础.html"><strong aria-hidden="true">5.</strong> 第三周运算电路基础</a></li><li class="chapter-item expanded "><a href="第四周乘除运算及浮点数运算.html"><strong aria-hidden="true">6.</strong> 第四周乘除运算及浮点数运算</a></li><li class="chapter-item expanded "><a href="第五周IA-32指令系统概述.html"><strong aria-hidden="true">7.</strong> 第五周IA-32指令系统概述</a></li><li class="chapter-item expanded "><a href="第六周IA-32指令类型.html"><strong aria-hidden="true">8.</strong> 第六周IA-32指令类型</a></li><li class="chapter-item expanded "><a href="第七周C语言语句的机器级表示.html"><strong aria-hidden="true">9.</strong> 第七周C语言语句的机器级表示</a></li><li class="chapter-item expanded "><a href="第八周复杂数据类型的机器级表示.html"><strong aria-hidden="true">10.</strong> 第八周复杂数据类型的机器级表示</a></li><li class="chapter-item expanded "><a href="第九周x86-64指令系统.html"><strong aria-hidden="true">11.</strong> 第九周x86-64指令系统</a></li><li class="chapter-item expanded "><a href="第十周链接概述和目标文件格式.html"><strong aria-hidden="true">12.</strong> 第十周链接概述和目标文件格式</a></li><li class="chapter-item expanded "><a href="第十一周符号及符号解析.html" class="active"><strong aria-hidden="true">13.</strong> 第十一周符号及符号解析</a></li><li class="chapter-item expanded "><a href="第十二周重定位及动态链接.html"><strong aria-hidden="true">14.</strong> 第十二周重定位及动态链接</a></li><li class="chapter-item expanded "><a href="计算机系统基础一期末考试.html"><strong aria-hidden="true">15.</strong> 计算机系统基础一期末考试</a></li><li class="chapter-item expanded "><a href="计算机系统基础二课程概述.html"><strong aria-hidden="true">16.</strong> 计算机系统基础二课程概述</a></li><li class="chapter-item expanded "><a href="第一周程序执行概述.html"><strong aria-hidden="true">17.</strong> 第一周程序执行概述</a></li><li class="chapter-item expanded "><a href="第二周主存储器组织.html"><strong aria-hidden="true">18.</strong> 第二周主存储器组织</a></li><li class="chapter-item expanded "><a href="第三周磁盘存储器.html"><strong aria-hidden="true">19.</strong> 第三周磁盘存储器</a></li><li class="chapter-item expanded "><a href="第四周高速缓存概述.html"><strong aria-hidden="true">20.</strong> 第四周高速缓存概述</a></li><li class="chapter-item expanded "><a href="第五周Cache替换算法和写策略.html"><strong aria-hidden="true">21.</strong> 第五周Cache替换算法和写策略</a></li><li class="chapter-item expanded "><a href="第六周虚拟存储器.html"><strong aria-hidden="true">22.</strong> 第六周虚拟存储器</a></li><li class="chapter-item expanded "><a href="第七周IA-32-Linux中的地址转换.html"><strong aria-hidden="true">23.</strong> 第七周IA-32/Linux中的地址转换</a></li><li class="chapter-item expanded "><a href="计算机系统基础二期末考試.html"><strong aria-hidden="true">24.</strong> 计算机系统基础二期末考試</a></li><li class="chapter-item expanded "><a href="计算机系统基础三课程概述.html"><strong aria-hidden="true">25.</strong> 计算机系统基础三课程概述</a></li><li class="chapter-item expanded "><a href="第一周进程和进程的上下文切换.html"><strong aria-hidden="true">26.</strong> 第一周进程和进程的上下文切换</a></li><li class="chapter-item expanded "><a href="第二周异常和中断.html"><strong aria-hidden="true">27.</strong> 第二周异常和中断</a></li><li class="chapter-item expanded "><a href="第三周IA-32中的异常及中断机制.html"><strong aria-hidden="true">28.</strong> 第三周IA-32中的异常及中断机制</a></li><li class="chapter-item expanded "><a href="第四周IA-32Linux中异常及中断处理.html"><strong aria-hidden="true">29.</strong> 第四周IA-32/Linux中异常/中断处理</a></li><li class="chapter-item expanded "><a href="第五周用户空间IO软件.html"><strong aria-hidden="true">30.</strong> 第五周用户空间I/O软件</a></li><li class="chapter-item expanded "><a href="第六周系统总线和系统互连.html"><strong aria-hidden="true">31.</strong> 第六周系统总线和系统互连</a></li><li class="chapter-item expanded "><a href="第七周IO方式和内核空间IO软件.html"><strong aria-hidden="true">32.</strong> 第七周IO方式和内核空间IO软件</a></li><li class="chapter-item expanded "><a href="计算机系统基础三期末考試.html"><strong aria-hidden="true">33.</strong> 计算机系统基础三期末考試</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">计算机系统基础</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="第十一周符号及符号解析"><a class="header" href="#第十一周符号及符号解析">第十一周符号及符号解析</a></h1>
<p><a href="https://rosefinch-midsummer.github.io/book/file/cs/course1-week11.pdf" target="_blank">在线阅读PDF文档</a></p>
<ul>
<li><a href="#%E7%AC%AC1%E8%AE%B2-%E7%AC%A6%E5%8F%B7%E5%8F%8A%E7%AC%A6%E5%8F%B7%E8%A1%A8">第1讲 符号及符号表</a>
<ul>
<li><a href="#%E7%AC%A6%E5%8F%B7%E5%92%8C%E7%AC%A6%E5%8F%B7%E8%A1%A8%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B527%E5%88%86%E9%92%9F">符号和符号表的基本概念（27分钟）</a></li>
<li><a href="#%E5%85%A8%E5%B1%80%E7%AC%A6%E5%8F%B7%E7%9A%84%E5%BC%BA%E5%BC%B1%E7%89%B9%E6%80%A78%E5%88%86%E9%92%9F">全局符号的强弱特性（8分钟）</a></li>
<li><a href="#%E5%A4%9A%E9%87%8D%E7%AC%A6%E5%8F%B7%E5%AE%9A%E4%B9%89%E4%B8%BE%E4%BE%8B21%E5%88%86%E9%92%9F">多重符号定义举例（21分钟）</a></li>
</ul>
</li>
<li><a href="#%E7%AC%AC2%E8%AE%B2-%E9%9D%99%E6%80%81%E9%93%BE%E6%8E%A5%E5%92%8C%E7%AC%A6%E5%8F%B7%E8%A7%A3%E6%9E%90">第2讲 静态链接和符号解析</a>
<ul>
<li><a href="#%E9%9D%99%E6%80%81%E5%85%B1%E4%BA%AB%E5%BA%93%E7%9A%84%E5%88%9B%E5%BB%BA15%E5%88%86%E9%92%9F">静态共享库的创建（15分钟）</a></li>
<li><a href="#%E7%AC%A6%E5%8F%B7%E8%A7%A3%E6%9E%90%E8%BF%87%E7%A8%8B13%E5%88%86%E9%92%9F">符号解析过程（13分钟）</a></li>
<li><a href="#%E9%93%BE%E6%8E%A5%E9%A1%BA%E5%BA%8F%E9%97%AE%E9%A2%9810%E5%88%86%E9%92%9F">链接顺序问题（10分钟）</a></li>
</ul>
</li>
<li><a href="#%E7%AC%AC%E5%8D%81%E4%B8%80%E5%91%A8%E5%B0%8F%E6%B5%8B%E9%AA%8C">第十一周小测验</a></li>
</ul>
<h2 id="第1讲-符号及符号表"><a class="header" href="#第1讲-符号及符号表">第1讲 符号及符号表</a></h2>
<h3 id="符号和符号表的基本概念27分钟"><a class="header" href="#符号和符号表的基本概念27分钟">符号和符号表的基本概念（27分钟）</a></h3>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost01/img/202311080854644.png" alt="" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost01/img/202311080857598.png" alt="" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost01/img/202311080859279.png" alt="" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost01/img/202311080902857.png" alt="" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost01/img/202311080911865.png" alt="" /></p>
<p><code>main.c</code>文件内容如下：</p>
<pre><code class="language-c">int buf[2] = {1,2};
void swap();
int main()
{
	swap();
	return 0;
}
</code></pre>
<p><code>swap.c</code>文件内容如下：</p>
<pre><code class="language-c">extern int buf[];
int *bufp0 = &amp;buf[0];
static int *bufp1;
void swap()
{
	int temp;
	bufp1 = &amp;buf[1];
	temp = *bufp0;
	*bufp0 = *bufp1;
	*bufp1 = temp;
}
</code></pre>
<pre><code class="language-bash">guangwudi@debian:~/csapp$ readelf -s p

Symbol table '.dynsym' contains 7 entries:
   Num:    Value  Size Type    Bind   Vis      Ndx Name
     0: 00000000     0 NOTYPE  LOCAL  DEFAULT  UND
     1: 00000000     0 FUNC    GLOBAL DEFAULT  UND _[...]@GLIBC_2.34 (2)
     2: 00000000     0 NOTYPE  WEAK   DEFAULT  UND _ITM_deregisterT[...]
     3: 00000000     0 FUNC    WEAK   DEFAULT  UND [...]@GLIBC_2.1.3 (3)
     4: 00000000     0 NOTYPE  WEAK   DEFAULT  UND __gmon_start__
     5: 00000000     0 NOTYPE  WEAK   DEFAULT  UND _ITM_registerTMC[...]
     6: 00002004     4 OBJECT  GLOBAL DEFAULT   16 _IO_stdin_used

Symbol table '.symtab' contains 43 entries:
   Num:    Value  Size Type    Bind   Vis      Ndx Name
     0: 00000000     0 NOTYPE  LOCAL  DEFAULT  UND
     1: 00000000     0 FILE    LOCAL  DEFAULT  ABS Scrt1.o
     2: 000001cc    32 OBJECT  LOCAL  DEFAULT    3 __abi_tag
     3: 00000000     0 FILE    LOCAL  DEFAULT  ABS main.c
     4: 00000000     0 FILE    LOCAL  DEFAULT  ABS crtstuff.c
     5: 000010b0     0 FUNC    LOCAL  DEFAULT   14 deregister_tm_clones
     6: 000010f0     0 FUNC    LOCAL  DEFAULT   14 register_tm_clones
     7: 00001140     0 FUNC    LOCAL  DEFAULT   14 __do_global_dtors_aux
     8: 00004018     1 OBJECT  LOCAL  DEFAULT   25 completed.0
     9: 00003eec     0 OBJECT  LOCAL  DEFAULT   20 __do_global_dtor[...]
    10: 00001190     0 FUNC    LOCAL  DEFAULT   14 frame_dummy
    11: 00003ee8     0 OBJECT  LOCAL  DEFAULT   19 __frame_dummy_in[...]
    12: 00000000     0 FILE    LOCAL  DEFAULT  ABS swap.c
    13: 00000000     0 FILE    LOCAL  DEFAULT  ABS crtstuff.c
    14: 00002114     0 OBJECT  LOCAL  DEFAULT   18 __FRAME_END__
    15: 00000000     0 FILE    LOCAL  DEFAULT  ABS
    16: 00003ef0     0 OBJECT  LOCAL  DEFAULT   21 _DYNAMIC
    17: 00002008     0 NOTYPE  LOCAL  DEFAULT   17 __GNU_EH_FRAME_HDR
    18: 00003ff4     0 OBJECT  LOCAL  DEFAULT   23 _GLOBAL_OFFSET_TABLE_
    19: 00000000     0 FUNC    GLOBAL DEFAULT  UND __libc_start_mai[...]
    20: 00000000     0 NOTYPE  WEAK   DEFAULT  UND _ITM_deregisterT[...]
    21: 000010a0     4 FUNC    GLOBAL HIDDEN    14 __x86.get_pc_thunk.bx
    22: 00004004     0 NOTYPE  WEAK   DEFAULT   24 data_start
    23: 00004018     0 NOTYPE  GLOBAL DEFAULT   24 _edata
    24: 000011c8     0 FUNC    GLOBAL HIDDEN    15 _fini
    25: 00001195     0 FUNC    GLOBAL HIDDEN    14 __x86.get_pc_thunk.dx
    26: 00000000     0 FUNC    WEAK   DEFAULT  UND __cxa_finalize@G[...]
    27: 00004004     0 NOTYPE  GLOBAL DEFAULT   24 __data_start
    28: 00004014     4 OBJECT  GLOBAL DEFAULT   24 bufp0
    29: 00000000     0 NOTYPE  WEAK   DEFAULT  UND __gmon_start__
    30: 00004008     0 OBJECT  GLOBAL HIDDEN    24 __dso_handle
    31: 00002004     4 OBJECT  GLOBAL DEFAULT   16 _IO_stdin_used
    32: 0000401c     0 NOTYPE  GLOBAL DEFAULT   25 _end
    33: 00001070    44 FUNC    GLOBAL DEFAULT   14 _start
    34: 00002000     4 OBJECT  GLOBAL DEFAULT   16 _fp_hw
    35: 0000400c     8 OBJECT  GLOBAL DEFAULT   24 buf
    36: 00004018     0 NOTYPE  GLOBAL DEFAULT   25 __bss_start
    37: 00001050    30 FUNC    GLOBAL DEFAULT   14 main
    38: 000011c3     0 FUNC    GLOBAL HIDDEN    14 __x86.get_pc_thunk.ax
    39: 00004018     0 OBJECT  GLOBAL HIDDEN    24 __TMC_END__
    40: 00000000     0 NOTYPE  WEAK   DEFAULT  UND _ITM_registerTMC[...]
    41: 000011a0    35 FUNC    GLOBAL DEFAULT   14 swap
    42: 00001000     0 FUNC    GLOBAL HIDDEN    11 _init

</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost01/img/202311080902857.png" alt="" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost01/img/202311080911865.png" alt="" /></p>
<pre><code class="language-bash">guangwudi@debian:~/csapp$ readelf -s hello.o

Symbol table '.symtab' contains 9 entries:
   Num:    Value  Size Type    Bind   Vis      Ndx Name
     0: 00000000     0 NOTYPE  LOCAL  DEFAULT  UND
     1: 00000000     0 FILE    LOCAL  DEFAULT  ABS hello.c
     2: 00000000     0 SECTION LOCAL  DEFAULT    2 .text
     3: 00000000     0 SECTION LOCAL  DEFAULT    6 .rodata
     4: 00000000     0 SECTION LOCAL  DEFAULT    7 .text.__x86.get_[...]
     5: 00000000    60 FUNC    GLOBAL DEFAULT    2 main
     6: 00000000     0 FUNC    GLOBAL HIDDEN     7 __x86.get_pc_thunk.ax
     7: 00000000     0 NOTYPE  GLOBAL DEFAULT  UND _GLOBAL_OFFSET_TABLE_
     8: 00000000     0 NOTYPE  GLOBAL DEFAULT  UND puts

</code></pre>
<p>使用<code>nm obj_file</code>列出目標文件obj_file的符號表</p>
<pre><code class="language-bash">guangwudi@debian:~/csapp$ nm hello.o
         U _GLOBAL_OFFSET_TABLE_
00000000 T main
         U puts
00000000 T __x86.get_pc_thunk.ax
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost01/img/202311080924077.png" alt="" /></p>
<p>这里提到偏移量是0时，在“Ot”属性下的“0”处划了红线。这里老师把“Ot”看成了“of”，想当然认为是offset，表示偏移量，实际上应该是“Other”属性。正确的做法应该是在（   value   ）属性下的取值处划线呢？</p>
<h3 id="全局符号的强弱特性8分钟"><a class="header" href="#全局符号的强弱特性8分钟">全局符号的强弱特性（8分钟）</a></h3>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost02/img/202311110940100.png" alt="" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost01/img/202311080944934.png" alt="" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost01/img/202311080946399.png" alt="" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost01/img/202311080952683.png" alt="" /></p>
<h3 id="多重符号定义举例21分钟"><a class="header" href="#多重符号定义举例21分钟">多重符号定义举例（21分钟）</a></h3>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost02/img/202311110917877.png" alt="" /></p>
<pre><code class="language-c">/*main.c*/
int x = 10;
int p1(void);
int main()
{
	x = p1();
	return x;
}
</code></pre>
<pre><code class="language-c">/*p1.c*/
int x = 20;
int p1()
{
	return x;
}
</code></pre>
<pre><code>guangwudi@debian:~/csapp$ gcc -static -o myproc main.c p1.c
/usr/bin/ld: /tmp/ccIGgPqC.o:(.data+0x0): multiple definition of `x'; /tmp/ccskziV9.o:(.data+0x0): first defined here
collect2: error: ld returned 1 exit status
</code></pre>
<p>在Code::Blocks中报错<code>error: ld returned 1 exit status</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost02/img/202311110940935.png" alt="" /></p>
<pre><code class="language-c">/*main.c*/
#include &lt;stdio.h&gt;
int y = 100;
int z;
void p1(void);
int main()
{
    z = 1000;
    p1();
    printf(&quot;y=%d,z=%d\n&quot;,y,z);
    return 0;
}

</code></pre>
<pre><code class="language-c">/*p1.c*/
int y;
int z;
void p1()
{
    y = 200;
    z = 2000;
}
</code></pre>
<p>在Code::Blocks中能正常输出结果：</p>
<pre><code>y=200,z=2000
</code></pre>
<p>但在Debian32-bit虚拟机中一直报错<code>multiple definition</code>，暂时无力解决。</p>
<pre><code>
guangwudi@debian:~/csapp$ gcc -c p1.c
guangwudi@debian:~/csapp$ ar rcs mylib.a p1.o
guangwudi@debian:~/csapp$ gcc -c main.c
guangwudi@debian:~/csapp$ gcc -static -o myproc main.o ./mylib.a
/usr/bin/ld: ./mylib.a(p1.o):(.bss+0x0): multiple definition of `y'; main.o:(.data+0x0): first defined here
/usr/bin/ld: ./mylib.a(p1.o):(.bss+0x4): multiple definition of `z'; main.o:(.bss+0x0): first defined here
collect2: error: ld returned 1 exit status
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost02/img/202311110941449.png" alt="" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost02/img/202311110941902.png" alt="" /></p>
<pre><code class="language-c">/*main.c*/
#include &lt;stdio.h&gt;
int d = 100;
int x = 200;
void p1(void);
int main()
{
    p1();
    printf(&quot;d=%d,x=%d\n&quot;,d,x);
    return 0;
}
</code></pre>
<pre><code class="language-c">/*p1.c*/
double d;

void p1()
{
    d = 1.0;
}
</code></pre>
<p>在Code::Blocks中能正常输出结果：</p>
<pre><code>d=0,x=1072693248
</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost02/img/202311110942091.png" alt="" /></p>
<h2 id="第2讲-静态链接和符号解析"><a class="header" href="#第2讲-静态链接和符号解析">第2讲 静态链接和符号解析</a></h2>
<h3 id="静态共享库的创建15分钟"><a class="header" href="#静态共享库的创建15分钟">静态共享库的创建（15分钟）</a></h3>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost01/img/202311080854644.png" alt="" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost01/img/202311101022942.png" alt="" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost02/img/202311101025906.png" alt="" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost02/img/202311101027643.png" alt="" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost02/img/202311101027194.png" alt="" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost02/img/202311101028976.png" alt="" /></p>
<pre><code class="language-c">/*myproc1.c*/
#include&lt;stdio.h&gt;
void myfunc1()
{
	printf(&quot;This is myfunc1!\n&quot;);
}
</code></pre>
<pre><code class="language-c">/*myproc2.c*/
#include&lt;stdio.h&gt;
void myfunc2()
{
	printf(&quot;This is myfunc2!\n&quot;);
}
</code></pre>
<pre><code class="language-c">/*main.c*/
void myfunc1(void);
int main()
{
	myfunc1();
	return 0;
}
</code></pre>
<pre><code class="language-bash">
guangwudi@debian:~/csapp$ vim myproc1.c
guangwudi@debian:~/csapp$ vim myproc2.c
guangwudi@debian:~/csapp$ gcc -c myproc1.c myproc2.c
guangwudi@debian:~/csapp$ ar rcs mylib.a myproc1.o myproc2.o
guangwudi@debian:~/csapp$ vim main.c
guangwudi@debian:~/csapp$ gcc -c main.c
guangwudi@debian:~/csapp$ gcc -static -o myproc main.o ./mylib.a
guangwudi@debian:~/csapp$ ./myproc
This is myfunc1!
</code></pre>
<h3 id="符号解析过程13分钟"><a class="header" href="#符号解析过程13分钟">符号解析过程（13分钟）</a></h3>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost02/img/202311101149325.png" alt="" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost02/img/202311101150707.png" alt="" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost02/img/202311101150115.png" alt="" /></p>
<h3 id="链接顺序问题10分钟"><a class="header" href="#链接顺序问题10分钟">链接顺序问题（10分钟）</a></h3>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost02/img/202311101150886.png" alt="" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost02/img/202311101151535.png" alt="" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost02/img/202311101151353.png" alt="" /></p>
<h2 id="第十一周小测验"><a class="header" href="#第十一周小测验">第十一周小测验</a></h2>
<p>1以下是链接过程中对符号定义的判断，其中错误的是（ A   ）。</p>
<p>A.全局变量声明“<code>int *xp=&amp;x;</code>”中，xp和x都是符号的定义</p>
<p>B.函数内的局部变量声明“short x=200;”中，x不是符号的定义</p>
<p>C.静态局部变量声明“<code>static int x=*xp</code>;”中，x是符号的定义</p>
<p>D.全局变量声明“int x, y;”中，x和y都是符号的定义</p>
<p>解释：<strong>局部变量不是符号，静态全局变量是局部符号</strong>。</p>
<p>2.若x为局部变量，xp、y和z是全局变量，则以下判断中错误的是（A   ）。</p>
<p>A.赋值语句“int y=x+z;”中，y和z都是符号的引用</p>
<p>B.赋值语句“<code>y=x+*xp;</code>”中，y和xp都是符号的引用</p>
<p>C.静态局部变量声明“<code>static int x=*xp;</code>”中，xp是符号的引用</p>
<p>D.赋值语句“y=x+z;”中，y和z都是符号的引用</p>
<p>3以下有关ELF目标文件的符号表的叙述中，错误的是（C  ）。</p>
<p>A.符号表定义在.symtab节中，每个表项描述某个符号的相应信息</p>
<p>B.通过符号表可获得符号的名称、所在节及在节中偏移地址和长度</p>
<p>C.符号表中包含了所有定义符号的描述信息，包括局部变量的相关信息</p>
<p>D.可重定位和可执行两种目标文件中都有符号表且数据结构一样</p>
<p>4以下是有关链接过程中符号解析（符号绑定）的叙述，其中错误的是（  B  ）。</p>
<p>A.全局符号（包括外部全局符号）需将模块内的引用与模块外的定义符号绑定</p>
<p>B.同一个符号名可能在多个模块中有定义，每个定义处的符号都须分配空间</p>
<p>C.符号解析的目的是将符号引用与某目标模块中定义的符号建立关联</p>
<p>D.本地符号的解析比较简单，只要与本模块内定义的符号关联即可</p>
<p>解释：一个符号变量只能有一个地址</p>
<p>5以下有关强符号和弱符号的符号解析的叙述中，错误的是（  C  ）。</p>
<p>A.一个符号名只能有一个强符号，否则符号解析失败</p>
<p>B.一个符号名可以有多个弱符号，任选一个为其定义</p>
<p>C.一个符号名可以仅出现在引用处或仅出现在定义处</p>
<p>D.一个符号名可以有一个强符号和多个弱符号，强符号为其定义</p>
<p>6以下是两个源程序文件：</p>
<pre><code class="language-C">/* m1.c */                                                      

int p1(viod);
int main()
{
	int p1= p1(); 
	return p1;
}  
</code></pre>
<pre><code class="language-C">/* m2.c */
static int main=1;
int p1()
{
	main++;
}
</code></pre>
<p>对于上述两个源程序文件链接时的符号解析，错误的是（ D   ）。</p>
<p>A.在m1中，定义了一个强符号main和一个弱符号p1</p>
<p>B.在m2中，定义了一个强符号p1和一个局部符号main</p>
<p>C.在m1中，对m2中定义的强符号p1的引用只有一处</p>
<p>D.因为出现了两个强符号main，所以会发生链接错误</p>
<p>7以下是两个源程序文件：</p>
<pre><code class="language-C">/* m1.c */                                                      

int p1;
int main()
{
	int p1= p1(); 
	return p1;
}  
</code></pre>
<pre><code class="language-C">/* m2.c */
int main=1;
int p1()
{
	int p1=main++;
	return main；
}
</code></pre>
<p>对于上述两个源程序文件链接时的符号解析，错误的是（  C ）。</p>
<p>A.在m1中，定义了一个强符号main和一个弱符号p1</p>
<p>B.在m2中，定义了一个强符号p1和一个强符号main</p>
<p>C.在模块m1的所有语句中，对符号p1的引用一共有三处</p>
<p>D.因为出现了两个强符号main，所以会发生链接错误</p>
<p>8以下是两个源程序文件：</p>
<pre><code class="language-C">/* m1.c */                                                      
int x=100;
int p1(void);
int main()
{
	x = p1(); 
	return x;
}  
</code></pre>
<pre><code class="language-C">/* m2.c */
float x;
static main=1;
int p1()
{
	int p1=main + (int)x;
	return p1；
}
</code></pre>
<p>对于上述两个源程序文件链接时的符号解析，错误的是（ C ）。</p>
<p>A.m1中对x的两处引用都与m1中对x的定义绑定</p>
<p>B.m2中的变量p1与函数p1被分配在不同存储区</p>
<p>C.m2中对x的引用与m2中对x的定义绑定</p>
<p>D.虽然x、main和p1都出现了多次定义，但不会发生链接错误</p>
<p>解释：从这里可以看出，return x不是对x的引用。。。</p>
<p>9以下是两个源程序文件：</p>
<pre><code class="language-C">/* m1.c */                                                      
#include &lt;stdio.h&gt;
int x=100;
short y=1, z=2;
int main()
{
	p1();
	printf(&quot;x=%d, z=%d\n&quot;,x,z);
}
</code></pre>
<pre><code class="language-C">/* m2.c */
double x;
void p1()
{
	x= -1.0;
}
</code></pre>
<p>上述程序执行的结果是（ B   ）。提示：1074790400=2^30+2^20，16400=2^14+2^4。</p>
<p>A.x=100, z=2</p>
<p>B.x=0, z=-16400</p>
<p>C.x=-1, z=2</p>
<p>D.x=-1074790400, z=0</p>
<p>解析：  B、该题中变量x在m1.c中为强符号，在m2.c中为弱符号。在调用p1函数后，x处原来存放的100被替换，-1.0的double类型表示为1 0111 1111 111 00…0，十六进制表示为BFF0 0000 0000 0000。因为x、y和z都是初始化变量，同在.data节中，链接后空间被分配在一起，x占4B，随后y和z各占2B。因为IA-32为小端方式，所以，x的机器数为全0，y的机器数也为全0，z的机器数为BFF0H。执行printf函数后x=0, z=-(2^14+2^4)=-16400。</p>
<p>10假设调用关系如下：func.o→libx.a和liby.a中的函数，libx.a→libz.a中的函数，libx.a和liby.a之间、liby.a和libz.a相互独立，则以下几个命令行中，静态链接发生错误的命令是（   B  ）。</p>
<p>A.gcc -static –o myfunc func.o libx.a libz.a liby.a</p>
<p>B.gcc -static –o myfunc func.o liby.a libz.a libx.a</p>
<p>C.gcc -static –o myfunc func.o liby.a libx.a libz.a</p>
<p>D.gcc -static –o myfunc func.o libx.a liby.a libz.a</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="第十周链接概述和目标文件格式.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="第十二周重定位及动态链接.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="第十周链接概述和目标文件格式.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="第十二周重定位及动态链接.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
